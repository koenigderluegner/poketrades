import{a as M,g as j}from"./chunk-37MB5HFO.js";import{n as Z,o as q,v as Q}from"./chunk-MQT4DWTQ.js";import{R,X as A,_ as G,aa as I,ea as J,g as Y,ja as U,k as H,o as F,pa as O,wc as z,xc as T,yc as W}from"./chunk-WK7ZMYIR.js";import{d as y,e as x,f as E,g as S}from"./chunk-2QKSPLSF.js";var V=(()=>{let o=class o{constructor(){this._httpClient=I(q),this._spreadsheetFields=["spreadsheetId","properties.title","sheets.properties","sheets.properties.sheetId","sheets.properties.title","sheets.properties.gridProperties.rowCount","sheets.properties.gridProperties.frozenRowCount","sheets.properties.gridProperties.columnCount","sheets.properties.gridProperties.frozenColumnCount"]}getSpreadsheet(t,r){return this._httpClient.get(`https://sheets.googleapis.com/v4/spreadsheets/${t}?includeGridData=false&fields=${this._spreadsheetFields.join(",")}&key=${r}`)}getBatchValues(t,r,m){let b=new Z;for(let C of r)b=b.append("ranges",C);return this._httpClient.get(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values:batchGet?key=${m}`,{params:b})}};o.\u0275fac=function(r){return new(r||o)},o.\u0275prov=A({token:o,factory:o.\u0275fac,providedIn:"root"});let k=o;return k})();var N=new G("API_KEY");var ee=(()=>{var o,P,t,r,m,b,C,c,te,se,_,L,re,ie,K;let B=class B{constructor(){x(this,c);x(this,o);x(this,P);x(this,t);x(this,r);x(this,m);x(this,b);x(this,C);this.spreadsheet=void 0,E(this,o,I(N)),E(this,P,I(U)),E(this,t,I(V)),E(this,r,I(M)),E(this,m,["Welcome","Living Dex","Shiny Living Dex","Breedables Overview","Alcremie","Tool:Breeding","Tool: Move Lookup","Breedables Ball Legality","Ban Checker","DB:Abilities","DB:Balls","DB:Pokemon","DB:LevelMoves","DB:Items","DB:Misc","DB:Moves","DB:Types","DB:Natures","Resource Gen7 (Backup)","Ban List"]),E(this,b,["dex","name","ability","owned","hasHA","ratio","move1","move2","move3","move4","nature","ball","gender","ot","amount","notes","event","isShiny","level","hp","atk","def","spa","spd","spe","item","id","dates","proof","tradeHistory","disclosure","lang","evhp","evatk","evdef","evspa","evspd","evspe","regularOwned","shinyOwned","slug"]),E(this,C,{type:["Valuables","Breedables","livingDex"],subType:["RNGs","Legendaries","Shinies","Competitives","Events"],ball:["Dream","Safari","Sport","Beast","Fast","Moon","Heavy","Love","Lure","Level","Friend","Pok\xE9","Great","Ultra","Premier","Dive","Luxury","Nest","Net","Repeat","Timer","Quick","Dusk","Heal"],includeShinies:["true","false"]})}getSpreadsheet(a,e){let u;return J(y(this,P),()=>Q({params:()=>({spreadsheetId:a()}),stream:({params:h})=>h.spreadsheetId?y(this,t).getSpreadsheet(h.spreadsheetId,e).pipe(R(p=>{if(!h.spreadsheetId)return H();u={id:a(),title:p.properties.title,worksheets:[],livingDexChecklist:[]},this.spreadsheet=u;let d=p.sheets.filter(i=>!y(this,m).includes(i.properties.title));return S(this,c,se).call(this,a,d).pipe(R(i=>(u.worksheets=i,this.spreadsheet=u,H(u))),F(i=>{for(let s of i.worksheets)if(s.data){if(s.ownedEntries=(s.data??[]).filter(g=>g.isOwned).length,s.config?.type==="Valuables"&&s.config?.subType==="Shinies")for(let g of s.data)g.isShiny=!0;if(s.config?.type==="Breedables"&&s.config?.ball)for(let g of s.data)g.ball=s.config?.ball}return i.hasBreedables=i.worksheets.some(s=>s.config?.type==="Breedables"),i.hasValuables=i.worksheets.some(s=>s.config?.type==="Valuables"),i.hasBreedables&&(i.overviewEntries=S(this,c,te).call(this,i.worksheets.filter(s=>s.config?.type==="Breedables"&&s.config?.ball))),i}))})):H(void 0)}))}getConfigs(a,e,u){return y(this,t).getBatchValues(a(),e,y(this,o)).pipe(R(h=>{let p=[];for(let d of h.valueRanges){let i=d.values?.[0]?.indexOf("config")??-1;if(i===-1)continue;let s=d.values.map(l=>l[i]).filter(Boolean);s.shift();let g=S(this,c,re).call(this,s),D=d.range.split("!")[0],n=S(this,c,L).call(this,D),f=u.find(l=>S(this,c,L).call(this,l.properties.title)===n),w=0,v=0;if(d.values[0].some((l,$)=>{if(y(this,b).includes(l))return w=$,!0}),d.values[0].slice().reverse().some((l,$)=>{if(y(this,b).includes(l))return v=d.values[0].length-1-$,!0}),g.type!=="unknown"){g.colIndex={min:w,max:v};let l={id:"0",title:D,slug:n,config:g,gridProperties:f?.properties.gridProperties??{columnCount:0,rowCount:0},headerIndex:d.values[0].slice(w,v+1),valueRange:""},$=`${S(this,c,_).call(this,l.config?.colIndex.min??0)}${(l.gridProperties.frozenRowCount??0)+1}`,ae=`${S(this,c,_).call(this,l.config?.colIndex.max??0)}${l.gridProperties.rowCount}`;l.valueRange=`${l.title}!${$}:${ae}`,l.title=D.replace(/'/g,""),p.push(l)}}return H(p)}))}};o=new WeakMap,P=new WeakMap,t=new WeakMap,r=new WeakMap,m=new WeakMap,b=new WeakMap,C=new WeakMap,c=new WeakSet,te=function(a){let e={};return a.forEach(u=>{let h=u.config?.ball?.toLowerCase(),p=u.data;h&&(e[h]={},p&&p.forEach(d=>{let i=d;e[h][i.iconSlug]=i}))}),e},se=function(a,e){let u=e.map(h=>`${h.properties.title}!A1:ZZ5`);return this.getConfigs(a,u,e).pipe(R(h=>{let p=h.map(d=>d.valueRange);return S(this,c,ie).call(this,a,p,h)}))},_=function(a){let p="";for(;a>=0;)p=String.fromCharCode(a%26+97)+p,a=Math.floor(a/26)-1;return p.toUpperCase()},L=function(a){let e=y(this,r).transform(a);return e[0]==="'"&&(e=e.substr(1)),e[e.length-1]==="'"&&(e=e.substr(0,e.length-1)),e},re=function(a){let e={type:"unknown",colIndex:{min:0,max:0}},u=0,h;for(let p of a){if(h=p.split(":"),h.length===2){let[d,i]=h;if(d in y(this,C)){let s=y(this,C)[d];s&&s.includes(i)&&(e[d]=d==="includeShinies"?j(i):i)}}u++}return e},ie=function(a,e,u){return y(this,t).getBatchValues(a(),e,y(this,o)).pipe(R(h=>(h.valueRanges.forEach(p=>{let d=p.range.split("!")[0],i=S(this,c,L).call(this,d),s=u.find(g=>S(this,c,L).call(this,g.slug)===i);if(s){let g=[];if(s.config?.type==="livingDex"){let D=[];p.values?.forEach(n=>{let f={slug:"",regular:!1,shiny:!1};n.forEach((w,v)=>{let l=s.headerIndex[v].trim();if(!(l===""||l==="dex"&&w.trim()==="")&&!["shinyIcon","icon","icon","dex"].includes(l))switch(l){case"shinyOwned":f.shiny=j(w.toLowerCase().trim());break;case"regularOwned":f.regular=j(w.toLowerCase().trim());break;case"slug":f.slug=S(this,c,K).call(this,w.trim());break}}),f.slug&&D.push(f)}),this.spreadsheet?.livingDexChecklist.push(...D);return}p.values?.forEach(D=>{let n={moves:[],evs:{},ivs:{}};D.forEach((f,w)=>{let v=s.headerIndex[w].trim();if(!(v===""||v==="dex"&&f.trim()==="")&&!["icon","egg"].includes(v))switch(v){case"hasHA":n.hasHiddenAbility=f.trim()==="x";break;case"move1":case"move2":case"move3":case"move4":Array.isArray(n.moves)&&n.moves.push(f);break;case"owned":n.isOwned=f.trim()==="x";break;case"hp":case"atk":case"def":case"spa":case"spd":case"spe":n.ivs&&(n.ivs[v]=f);break;case"evhp":case"evatk":case"evdef":case"evspa":case"evspd":case"evspe":n.evs&&(n.evs[v]=f);break;case"isShiny":n.isShiny=f.trim()!=="";break;case"ball":n.ball=f.replace(" Ball","").trim();break;default:n[v]=f}}),n.name&&(n.iconSlug=S(this,c,K).call(this,n.name)),n.isOwned=n.isOwned||s.config?.type==="Valuables",n.dex&&g.push(n)}),s.data=g}}),H(u))))},K=function(a){let e=a.toLowerCase().replace("nidoran \u2640","nidoran-f");return e=e.replace("nidoran \u2642","nidoran-m"),e=new M().transform(e),e=e.replace("-antique",""),e=e.replace("-gigantamax","-gmax"),e=e.replace("-low-key-gmax","-gmax"),e},B.\u0275fac=function(e){return new(e||B)},B.\u0275prov=A({token:B,factory:B.\u0275fac,providedIn:"root"});let k=B;return k})();var Be=(()=>{let o=class o{loadCachedSpreadsheet(t){let r=localStorage.getItem(this._SPREADHSEET_CACHE_KEY);if(r){let m=JSON.parse(r);if(m.id===t)return this.currentSpreadsheetRef.set(m.value),!0}return!1}constructor(){this.spreadsheetService=I(ee),this.apiKey=I(N),this._searchHistory=O([]),this.currentSpreadsheetId=O(""),this.currentSpreadsheetRef=this.spreadsheetService.getSpreadsheet(this.currentSpreadsheetId,this.apiKey),this.currentSpreadsheet=W({source:()=>this.currentSpreadsheetRef.value(),computation:(t,r)=>t||r?.value}),this.currentSearchTerm=O(""),this.searchResult=this.spreadsheetService.getSpreadsheet(this.currentSearchTerm,this.apiKey),this.sheetURLPath=z(()=>{let t=this.currentSpreadsheetRef.value();return t?.username?`u/${t.username}`:t?.id??""}),this._SPREADHSEET_CACHE_KEY="cachedSpreadsheet",T(()=>{let t=this.searchResult.value();t&&this.saveToHistory(t)}),T(()=>{let t=this.currentSpreadsheetRef.value();t&&localStorage.setItem(this._SPREADHSEET_CACHE_KEY,JSON.stringify({id:t.id,value:t}))}),localStorage.getItem("spreadsheetHistory")?this._searchHistory.set(JSON.parse(localStorage.getItem("spreadsheetHistory")??[].toString())):localStorage.setItem("spreadsheetHistory",JSON.stringify([])),this._currentSpreadsheet$=new Y({title:"",hasBreedables:!1,hasValuables:!1,worksheets:[],livingDexChecklist:[],id:""})}getCurrentSpreadsheet$(){return this._currentSpreadsheet$}updateCurrentSpreadsheet(t){this.currentSpreadsheetRef.set(t)}getSpreadsheetHistory$(){return this._searchHistory}convertApiErrors(t){let r={state:"unknown",message:""};switch(t){case 429:r.message="Too many requests: Google request limit reached, try again later.";break;case 404:r.message="Cannot find a spreadsheet with given ID.";break;default:r.message="Unknown Error: please check the given ID and publish your sheet if not already.";break}return r}saveToHistory(t){this._searchHistory.update(r=>{let m=r.findIndex(b=>b.id===t.id);return m!==-1&&r.splice(m,1),r.unshift({title:t.title,id:t.id,saveDate:new Date().toTimeString()}),localStorage.setItem("spreadsheetHistory",JSON.stringify(r)),[...r]})}};o.\u0275fac=function(r){return new(r||o)},o.\u0275prov=A({token:o,factory:o.\u0275fac,providedIn:"root"});let k=o;return k})();export{N as a,Be as b};
