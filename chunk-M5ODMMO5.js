import{a as H,b as C}from"./chunk-I2HAM4C4.js";import{$ as D,Ca as L,H as $,Y as y,ca as v,ia as g,n as m,r as k,s as B,ub as N,v as E}from"./chunk-JPC6FYMI.js";var I={production:!0,googleApiKey:"AIzaSyChHDClwdlSOIs8rrjoQrzOMpmsQTgg87E"};var A=(()=>{let o=class o{constructor(){this.charMap={" ":" ","\xA1":"!","\xA2":"c","\xA3":"lb","\xA5":"yen","\xA6":"|","\xA7":"SS","\xA8":'"',"\xA9":"(c)",\u00AA:"a","\xAB":"<<","\xAC":"not","\xAD":"-","\xAE":"(R)","\xB0":"^0","\xB1":"+/-","\xB2":"^2","\xB3":"^3","\xB4":"'",\u00B5:"u","\xB6":"P","\xB7":".","\xB8":",","\xB9":"^1",\u00BA:"o","\xBB":">>","\xBC":" 1/4 ","\xBD":" 1/2 ","\xBE":" 3/4 ","\xBF":"?",\u00C0:"`A",\u00C1:"'A",\u00C2:"^A",\u00C3:"~A",\u00C4:'"A',\u00C5:"A",\u00C6:"AE",\u00C7:"C",\u00C8:"`E",\u00C9:"'E",\u00CA:"^E",\u00CB:'"E',\u00CC:"`I",\u00CD:"'I",\u00CE:"^I",\u00CF:'"I',\u00D0:"D",\u00D1:"~N",\u00D2:"`O",\u00D3:"'O",\u00D4:"^O",\u00D5:"~O",\u00D6:'"O',"\xD7":"x",\u00D8:"O",\u00D9:"`U",\u00DA:"'U",\u00DB:"^U",\u00DC:'"U',\u00DD:"'Y",\u00DE:"Th",\u00DF:"ss",\u00E0:"`a",\u00E1:"'a",\u00E2:"^a",\u00E3:"~a",\u00E4:'"a',\u00E5:"a",\u00E6:"ae",\u00E7:"c",\u00E8:"`e",\u00E9:"'e",\u00EA:"^e",\u00EB:'"e',\u00EC:"`i",\u00ED:"'i",\u00EE:"^i",\u00EF:'"i',\u00F0:"d",\u00F1:"~n",\u00F2:"`o",\u00F3:"'o",\u00F4:"^o",\u00F5:"~o",\u00F6:'"o',"\xF7":":",\u00F8:"o",\u00F9:"`u",\u00FA:"'u",\u00FB:"^u",\u00FC:'"u',\u00FD:"'y",\u00FE:"th",\u00FF:'"y',\u0100:"A",\u0101:"a",\u0102:"A",\u0103:"a",\u0104:"A",\u0105:"a",\u0106:"'C",\u0107:"'c",\u0108:"^C",\u0109:"^c",\u010A:"C",\u010B:"c",\u010C:"C",\u010D:"c",\u010E:"D",\u010F:"d",\u0110:"D",\u0111:"d",\u0112:"E",\u0113:"e",\u0114:"E",\u0115:"e",\u0116:"E",\u0117:"e",\u0118:"E",\u0119:"e",\u011A:"E",\u011B:"e",\u011C:"^G",\u011D:"^g",\u011E:"G",\u011F:"g",\u0120:"G",\u0121:"g",\u0122:"G",\u0123:"g",\u0124:"^H",\u0125:"^h",\u0126:"H",\u0127:"h",\u0128:"~I",\u0129:"~i",\u012A:"I",\u012B:"i",\u012C:"I",\u012D:"i",\u012E:"I",\u012F:"i",\u0130:"I",\u0131:"i",\u0132:"IJ",\u0133:"ij",\u0134:"^J",\u0135:"^j",\u0136:"K",\u0137:"k",\u0139:"L",\u013A:"l",\u013B:"L",\u013C:"l",\u013D:"L",\u013E:"l",\u013F:"L",\u0140:"l",\u0141:"L",\u0142:"l",\u0143:"'N",\u0144:"'n",\u0145:"N",\u0146:"n",\u0147:"N",\u0148:"n",\u0149:"'n",\u014C:"O",\u014D:"o",\u014E:"O",\u014F:"o",\u0150:'"O',\u0151:'"o',\u0152:"OE",\u0153:"oe",\u0154:"'R",\u0155:"'r",\u0156:"R",\u0157:"r",\u0158:"R",\u0159:"r",\u015A:"'S",\u015B:"'s",\u015C:"^S",\u015D:"^s",\u015E:"S",\u015F:"s",\u0160:"S",\u0161:"s",\u0162:"T",\u0163:"t",\u0164:"T",\u0165:"t",\u0166:"T",\u0167:"t",\u0168:"~U",\u0169:"~u",\u016A:"U",\u016B:"u",\u016C:"U",\u016D:"u",\u016E:"U",\u016F:"u",\u0170:'"U',\u0171:'"u',\u0172:"U",\u0173:"u",\u0174:"^W",\u0175:"^w",\u0176:"^Y",\u0177:"^y",\u0178:'"Y',\u0179:"'Z",\u017A:"'z",\u017B:"Z",\u017C:"z",\u017D:"Z",\u017E:"z",\u017F:"s"}}transform(t){if(!t)return"";let e=[],s,r;for(let n=0;n<t.length;n++)r=t.charCodeAt(n),r<384&&(s=String.fromCharCode(r),e.push(this.charMap[s]||s));return t=e.join(""),t=t.replace(/[^\w\s-]/g,"").trim().toLowerCase(),t.replace(/[-\s]+/g,"-")}};o.\u0275fac=function(e){return new(e||o)},o.\u0275pipe=N({name:"slugify",type:o,pure:!0});let i=o;return i})();var O=(()=>{let o=class o{constructor(){this._httpClient=g(C),this._spreadsheetFields=["spreadsheetId","properties.title","sheets.properties","sheets.properties.sheetId","sheets.properties.title","sheets.properties.gridProperties.rowCount","sheets.properties.gridProperties.frozenRowCount","sheets.properties.gridProperties.columnCount","sheets.properties.gridProperties.frozenColumnCount"]}getSpreadsheet(t,e){return this._httpClient.get(`https://sheets.googleapis.com/v4/spreadsheets/${t}?includeGridData=false&fields=${this._spreadsheetFields.join(",")}&key=${e}`)}getBatchValues(t,e,s){let r=new H;for(let n of e)r=r.append("ranges",n);return this._httpClient.get(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values:batchGet?key=${s}`,{params:r})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=v({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();function P(i){return i!=null&&`${i}`!="false"}function Z(i,o=0){return T(i)?Number(i):arguments.length===2?o:0}function T(i){return!isNaN(parseFloat(i))&&!isNaN(Number(i))}function J(i){return Array.isArray(i)?i:[i]}function V(i){return i==null?"":typeof i=="string"?i:`${i}px`}function K(i){return i instanceof L?i.nativeElement:i}var j=(()=>{let o=class o{constructor(){this.httpClient=g(C),this.gss=g(O),this.slugifyPipe=g(A),this.bannedSheets=["Welcome","Living Dex","Shiny Living Dex","Breedables Overview","Alcremie","Tool:Breeding","Tool: Move Lookup","Breedables Ball Legality","Ban Checker","DB:Abilities","DB:Balls","DB:Pokemon","DB:LevelMoves","DB:Items","DB:Misc","DB:Moves","DB:Types","DB:Natures","Resource Gen7 (Backup)","Ban List"],this.possibleHeaders=["dex","name","ability","owned","hasHA","ratio","move1","move2","move3","move4","nature","ball","gender","ot","amount","notes","event","isShiny","level","hp","atk","def","spa","spd","spe","item","id","dates","proof","tradeHistory","disclosure","lang","evhp","evatk","evdef","evspa","evspd","evspe"],this.allowedConfigs={type:["Valuables","Breedables"],subType:["RNGs","Legendaries","Shinies","Competitives","Events"],ball:["Dream","Safari","Sport","Beast","Fast","Moon","Heavy","Love","Lure","Level","Friend","Pok\xE9","Great","Ultra","Premier","Dive","Luxury","Nest","Net","Repeat","Timer","Quick","Dusk","Heal"],includeShinies:["true","false"]}}getSpreadsheet(t,e){let s;return this.gss.getSpreadsheet(t,e).pipe(y(r=>{s={id:t,title:r.properties.title,worksheets:[]};let n=r.sheets.filter(c=>!this.bannedSheets.includes(c.properties.title));return this._getWorksheets(t,n)}),y(r=>(s.worksheets=r,k(s))))}getConfigs(t,e,s){return this.gss.getBatchValues(t,e,I.googleApiKey).pipe(y(r=>{let n=[];for(let c of r.valueRanges){let p=c.values?.[0]?.indexOf("config")??-1;if(p===-1)continue;let f=c.values.map(l=>l[p]).filter(Boolean);f.shift();let d=this.getWorksheetConfig(f),S=c.range.split("!")[0],a=this.slugifySheetName(S),u=s.find(l=>this.slugifySheetName(l.properties.title)===a),b=0,h=0;if(c.values[0].some((l,w)=>{if(this.possibleHeaders.includes(l))return b=w,!0}),c.values[0].slice().reverse().some((l,w)=>{if(this.possibleHeaders.includes(l))return h=c.values[0].length-1-w,!0}),d.type!=="unknown"){d.colIndex={min:b,max:h};let l={id:"0",title:S,slug:a,config:d,gridProperties:u?.properties.gridProperties??{columnCount:0,rowCount:0},headerIndex:c.values[0].slice(b,h+1),valueRange:""},w=`${this.numberToColumnName(l.config?.colIndex.min??0)}${(l.gridProperties.frozenRowCount??0)+1}`,R=`${this.numberToColumnName(l.config?.colIndex.max??0)}${l.gridProperties.rowCount}`;l.valueRange=`${l.title}!${w}:${R}`,l.title=S.replace(/'/g,""),n.push(l)}}return k(n)}))}_getWorksheets(t,e){let s=e.map(r=>`${r.properties.title}!A1:ZZ5`);return this.getConfigs(t,s,e).pipe(y(r=>{let n=r.map(c=>c.valueRange);return this.getWorksheetValues(t,n,r)}))}numberToColumnName(t){let n="";for(;t>=0;)n=String.fromCharCode(t%26+97)+n,t=Math.floor(t/26)-1;return n.toUpperCase()}slugifySheetName(t){let e=this.slugifyPipe.transform(t);return e[0]==="'"&&(e=e.substr(1)),e[e.length-1]==="'"&&(e=e.substr(0,e.length-1)),e}getWorksheetConfig(t){let e={type:"unknown",colIndex:{min:0,max:0}},s=0,r;for(let n of t){if(r=n.split(":"),r.length===2){let[c,p]=r;if(c in this.allowedConfigs){let f=this.allowedConfigs[c];f&&f.includes(p)&&(e[c]=c==="includeShinies"?P(p):p)}}s++}return e}getWorksheetValues(t,e,s){return this.gss.getBatchValues(t,e,I.googleApiKey).pipe(y(r=>(r.valueRanges.forEach(n=>{let c=n.range.split("!")[0],p=this.slugifySheetName(c),f=s.find(d=>this.slugifySheetName(d.slug)===p);if(f){let d=[];n.values?.forEach(S=>{let a={moves:[],evs:{},ivs:{}};S.forEach((u,b)=>{let h=f.headerIndex[b].trim();if(!(h===""||h==="dex"&&u.trim()==="")&&!["icon","egg"].includes(h))switch(h){case"hasHA":a.hasHiddenAbility=u.trim()==="x";break;case"move1":case"move2":case"move3":case"move4":Array.isArray(a.moves)&&a.moves.push(u);break;case"owned":a.isOwned=u.trim()==="x";break;case"hp":case"atk":case"def":case"spa":case"spd":case"spe":a.ivs&&(a.ivs[h]=u);break;case"evhp":case"evatk":case"evdef":case"evspa":case"evspd":case"evspe":a.evs&&(a.evs[h]=u);break;case"isShiny":a.isShiny=u.trim()!=="";break;case"ball":a.ball=u.replace(" Ball","").trim();break;default:a[h]=u}}),a.name&&(a.iconSlug=this._generateIconSlug(a.name)),a.isOwned=a.isOwned||f.config?.type==="Valuables",a.dex&&d.push(a)}),f.data=d}}),k(s))))}_generateIconSlug(t){let e=t.toLowerCase().replace("nidoran \u2640","nidoran-f");return e=e.replace("nidoran \u2642","nidoran-m"),e=new A().transform(e),e=e.replace("-antique",""),e=e.replace("-gigantamax","-gmax"),e=e.replace("-low-key-gmax","-gmax"),e}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=v({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var he=(()=>{let o=class o{constructor(){this.spreadsheetService=g(j),localStorage.getItem("spreadsheetHistory")?this._searchHistory=new m(JSON.parse(localStorage.getItem("spreadsheetHistory")??[].toString())):(localStorage.setItem("spreadsheetHistory",JSON.stringify([])),this._searchHistory=new m([])),this._currentSpreadsheet$=new m({title:"",hasBreedables:!1,hasValuables:!1,worksheets:[],id:""}),this._isDefaultSheet$=new m(!0),this._isLoading$=new m(!1)}getCurrentSpreadsheet$(){return this._currentSpreadsheet$}searchSpreadsheet(t,e){return this.loadSpreadsheet(t,e).pipe(D(s=>this.saveToHistory(s)))}loadSpreadsheet(t,e){return this.updateIsLoading(!0),this.spreadsheetService.getSpreadsheet(t,e).pipe(E(s=>{for(let r of s.worksheets)if(r.data){if(r.ownedEntries=(r.data??[]).filter(n=>n.isOwned).length,r.config?.type==="Valuables"&&r.config?.subType==="Shinies")for(let n of r.data)n.isShiny=!0;if(r.config?.type==="Breedables"&&r.config?.ball)for(let n of r.data)n.ball=r.config?.ball}return s.hasBreedables=s.worksheets.some(r=>r.config?.type==="Breedables"),s.hasValuables=s.worksheets.some(r=>r.config?.type==="Valuables"),s.hasBreedables&&(s.overviewEntries=this.buildOverviewEntries(s.worksheets.filter(r=>r.config?.type==="Breedables"&&r.config?.ball))),this.updateIsLoading(!1),s}),$(s=>(this.updateIsLoading(!1),console.error(s),B(this.convertApiErrors(""+s.status)))))}updateCurrentSpreadsheet(t){return this.updateIsDefaultSpreadhseet(!1),this._currentSpreadsheet$.next(t),this.getCurrentSpreadsheet$()}updateIsDefaultSpreadhseet(t){return this._isDefaultSheet$.next(t),this._isDefaultSheet$}updateIsLoading(t){return this._isLoading$.next(t),this.isLoading$()}isLoading$(){return this._isLoading$}isDefaultSpreadhseet$(){return this._isDefaultSheet$}getSpreadsheetHistory$(){return this._searchHistory}convertApiErrors(t){let e={state:"unknown",message:""};switch(t){case"429":e.message="Too many requests: Google request limit reached, try again later.";break;default:e.message="Unknown Error: please check the given ID and publish your sheet if not already.";break}return e}saveToHistory(t){let e=JSON.parse(localStorage.getItem("spreadsheetHistory")??[].toString()),s=e.findIndex(r=>r.id===t.id);s!==-1&&e.splice(s,1),e.unshift({title:t.title,id:t.id,saveDate:new Date().toTimeString()}),localStorage.setItem("spreadsheetHistory",JSON.stringify(e)),this._searchHistory.next(e)}buildOverviewEntries(t){let e={};return t.forEach(s=>{let r=s.config?.ball?.toLowerCase(),n=s.data;r&&(e[r]={},n&&n.forEach(c=>{let p=c;e[r][p.iconSlug]=p}))}),e}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=v({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();export{I as a,A as b,P as c,Z as d,T as e,J as f,V as g,K as h,he as i};
