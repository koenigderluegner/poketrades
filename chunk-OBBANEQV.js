import{a as C,b as x}from"./chunk-5GAHDUDC.js";import{a as L,b as A}from"./chunk-TWKCXHJT.js";import{R as S,U as H,X as b,ba as v,g as y,k,l as D,o as B,z as $}from"./chunk-CMTCFLWU.js";var I={production:!0,googleApiKey:"AIzaSyChHDClwdlSOIs8rrjoQrzOMpmsQTgg87E"};var O=(()=>{let o=class o{constructor(){this._httpClient=v(A),this._spreadsheetFields=["spreadsheetId","properties.title","sheets.properties","sheets.properties.sheetId","sheets.properties.title","sheets.properties.gridProperties.rowCount","sheets.properties.gridProperties.frozenRowCount","sheets.properties.gridProperties.columnCount","sheets.properties.gridProperties.frozenColumnCount"]}getSpreadsheet(t,e){return this._httpClient.get(`https://sheets.googleapis.com/v4/spreadsheets/${t}?includeGridData=false&fields=${this._spreadsheetFields.join(",")}&key=${e}`)}getBatchValues(t,e,r){let s=new L;for(let i of e)s=s.append("ranges",i);return this._httpClient.get(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values:batchGet?key=${r}`,{params:s})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=b({token:o,factory:o.\u0275fac,providedIn:"root"});let u=o;return u})();var P=(()=>{let o=class o{constructor(){this.spreadsheet=void 0,this.gss=v(O),this.slugifyPipe=v(C),this.bannedSheets=["Welcome","Living Dex","Shiny Living Dex","Breedables Overview","Alcremie","Tool:Breeding","Tool: Move Lookup","Breedables Ball Legality","Ban Checker","DB:Abilities","DB:Balls","DB:Pokemon","DB:LevelMoves","DB:Items","DB:Misc","DB:Moves","DB:Types","DB:Natures","Resource Gen7 (Backup)","Ban List"],this.possibleHeaders=["dex","name","ability","owned","hasHA","ratio","move1","move2","move3","move4","nature","ball","gender","ot","amount","notes","event","isShiny","level","hp","atk","def","spa","spd","spe","item","id","dates","proof","tradeHistory","disclosure","lang","evhp","evatk","evdef","evspa","evspd","evspe","regularOwned","shinyOwned","slug"],this.allowedConfigs={type:["Valuables","Breedables","livingDex"],subType:["RNGs","Legendaries","Shinies","Competitives","Events"],ball:["Dream","Safari","Sport","Beast","Fast","Moon","Heavy","Love","Lure","Level","Friend","Pok\xE9","Great","Ultra","Premier","Dive","Luxury","Nest","Net","Repeat","Timer","Quick","Dusk","Heal"],includeShinies:["true","false"]}}getSpreadsheet(t,e){let r;return this.gss.getSpreadsheet(t,e).pipe(S(s=>{r={id:t,title:s.properties.title,worksheets:[],livingDexChecklist:[]},this.spreadsheet=r;let i=s.sheets.filter(l=>!this.bannedSheets.includes(l.properties.title));return this._getWorksheets(t,i)}),S(s=>(r.worksheets=s,this.spreadsheet=r,k(r))))}getConfigs(t,e,r){return this.gss.getBatchValues(t,e,I.googleApiKey).pipe(S(s=>{let i=[];for(let l of s.valueRanges){let d=l.values?.[0]?.indexOf("config")??-1;if(d===-1)continue;let p=l.values.map(a=>a[d]).filter(Boolean);p.shift();let m=this.getWorksheetConfig(p),f=l.range.split("!")[0],n=this.slugifySheetName(f),c=r.find(a=>this.slugifySheetName(a.properties.title)===n),g=0,h=0;if(l.values[0].some((a,w)=>{if(this.possibleHeaders.includes(a))return g=w,!0}),l.values[0].slice().reverse().some((a,w)=>{if(this.possibleHeaders.includes(a))return h=l.values[0].length-1-w,!0}),m.type!=="unknown"){m.colIndex={min:g,max:h};let a={id:"0",title:f,slug:n,config:m,gridProperties:c?.properties.gridProperties??{columnCount:0,rowCount:0},headerIndex:l.values[0].slice(g,h+1),valueRange:""},w=`${this.numberToColumnName(a.config?.colIndex.min??0)}${(a.gridProperties.frozenRowCount??0)+1}`,N=`${this.numberToColumnName(a.config?.colIndex.max??0)}${a.gridProperties.rowCount}`;a.valueRange=`${a.title}!${w}:${N}`,a.title=f.replace(/'/g,""),i.push(a)}}return k(i)}))}_getWorksheets(t,e){let r=e.map(s=>`${s.properties.title}!A1:ZZ5`);return this.getConfigs(t,r,e).pipe(S(s=>{let i=s.map(l=>l.valueRange);return this.getWorksheetValues(t,i,s)}))}numberToColumnName(t){let i="";for(;t>=0;)i=String.fromCharCode(t%26+97)+i,t=Math.floor(t/26)-1;return i.toUpperCase()}slugifySheetName(t){let e=this.slugifyPipe.transform(t);return e[0]==="'"&&(e=e.substr(1)),e[e.length-1]==="'"&&(e=e.substr(0,e.length-1)),e}getWorksheetConfig(t){let e={type:"unknown",colIndex:{min:0,max:0}},r=0,s;for(let i of t){if(s=i.split(":"),s.length===2){let[l,d]=s;if(l in this.allowedConfigs){let p=this.allowedConfigs[l];p&&p.includes(d)&&(e[l]=l==="includeShinies"?x(d):d)}}r++}return e}getWorksheetValues(t,e,r){return this.gss.getBatchValues(t,e,I.googleApiKey).pipe(S(s=>(s.valueRanges.forEach(i=>{let l=i.range.split("!")[0],d=this.slugifySheetName(l),p=r.find(m=>this.slugifySheetName(m.slug)===d);if(p){let m=[];if(p.config?.type==="livingDex"){let f=[];i.values?.forEach(n=>{let c={slug:"",regular:!1,shiny:!1};n.forEach((g,h)=>{let a=p.headerIndex[h].trim();if(!(a===""||a==="dex"&&g.trim()==="")&&!["shinyIcon","icon","icon","dex"].includes(a))switch(a){case"shinyOwned":c.shiny=x(g.toLowerCase().trim());break;case"regularOwned":c.regular=x(g.toLowerCase().trim());break;case"pokemon":c.slug=this._generateIconSlug(g.trim());break}}),f.push(c)}),console.log(f),this.spreadsheet?.livingDexChecklist.push(...f);return}i.values?.forEach(f=>{let n={moves:[],evs:{},ivs:{}};f.forEach((c,g)=>{let h=p.headerIndex[g].trim();if(!(h===""||h==="dex"&&c.trim()==="")&&!["icon","egg"].includes(h))switch(h){case"hasHA":n.hasHiddenAbility=c.trim()==="x";break;case"move1":case"move2":case"move3":case"move4":Array.isArray(n.moves)&&n.moves.push(c);break;case"owned":n.isOwned=c.trim()==="x";break;case"hp":case"atk":case"def":case"spa":case"spd":case"spe":n.ivs&&(n.ivs[h]=c);break;case"evhp":case"evatk":case"evdef":case"evspa":case"evspd":case"evspe":n.evs&&(n.evs[h]=c);break;case"isShiny":n.isShiny=c.trim()!=="";break;case"ball":n.ball=c.replace(" Ball","").trim();break;default:n[h]=c}}),n.name&&(n.iconSlug=this._generateIconSlug(n.name)),n.isOwned=n.isOwned||p.config?.type==="Valuables",n.dex&&m.push(n)}),p.data=m}}),k(r))))}_generateIconSlug(t){let e=t.toLowerCase().replace("nidoran \u2640","nidoran-f");return e=e.replace("nidoran \u2642","nidoran-m"),e=new C().transform(e),e=e.replace("-antique",""),e=e.replace("-gigantamax","-gmax"),e=e.replace("-low-key-gmax","-gmax"),e}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=b({token:o,factory:o.\u0275fac,providedIn:"root"});let u=o;return u})();var te=(()=>{let o=class o{constructor(){this.spreadsheetService=v(P),localStorage.getItem("spreadsheetHistory")?this._searchHistory=new y(JSON.parse(localStorage.getItem("spreadsheetHistory")??[].toString())):(localStorage.setItem("spreadsheetHistory",JSON.stringify([])),this._searchHistory=new y([])),this._currentSpreadsheet$=new y({title:"",hasBreedables:!1,hasValuables:!1,worksheets:[],livingDexChecklist:[],id:""}),this._isDefaultSheet$=new y(!0),this._isLoading$=new y(!1)}getCurrentSpreadsheet$(){return this._currentSpreadsheet$}searchSpreadsheet(t,e){return this.loadSpreadsheet(t,e).pipe(H(r=>this.saveToHistory(r)))}loadSpreadsheet(t,e){return this.updateIsLoading(!0),this.spreadsheetService.getSpreadsheet(t,e).pipe(B(r=>{for(let s of r.worksheets)if(s.data){if(s.ownedEntries=(s.data??[]).filter(i=>i.isOwned).length,s.config?.type==="Valuables"&&s.config?.subType==="Shinies")for(let i of s.data)i.isShiny=!0;if(s.config?.type==="Breedables"&&s.config?.ball)for(let i of s.data)i.ball=s.config?.ball}return r.hasBreedables=r.worksheets.some(s=>s.config?.type==="Breedables"),r.hasValuables=r.worksheets.some(s=>s.config?.type==="Valuables"),r.hasBreedables&&(r.overviewEntries=this.buildOverviewEntries(r.worksheets.filter(s=>s.config?.type==="Breedables"&&s.config?.ball))),this.updateIsLoading(!1),r}),$(r=>(this.updateIsLoading(!1),console.error(r),D(this.convertApiErrors(""+r.status)))))}updateCurrentSpreadsheet(t){return this.updateIsDefaultSpreadhseet(!1),this._currentSpreadsheet$.next(t),this.getCurrentSpreadsheet$()}updateIsDefaultSpreadhseet(t){return this._isDefaultSheet$.next(t),this._isDefaultSheet$}updateIsLoading(t){return this._isLoading$.next(t),this.isLoading$()}isLoading$(){return this._isLoading$}isDefaultSpreadhseet$(){return this._isDefaultSheet$}getSpreadsheetHistory$(){return this._searchHistory}convertApiErrors(t){let e={state:"unknown",message:""};switch(t){case"429":e.message="Too many requests: Google request limit reached, try again later.";break;default:e.message="Unknown Error: please check the given ID and publish your sheet if not already.";break}return e}saveToHistory(t){let e=JSON.parse(localStorage.getItem("spreadsheetHistory")??[].toString()),r=e.findIndex(s=>s.id===t.id);r!==-1&&e.splice(r,1),e.unshift({title:t.title,id:t.id,saveDate:new Date().toTimeString()}),localStorage.setItem("spreadsheetHistory",JSON.stringify(e)),this._searchHistory.next(e)}buildOverviewEntries(t){let e={};return t.forEach(r=>{let s=r.config?.ball?.toLowerCase(),i=r.data;s&&(e[s]={},i&&i.forEach(l=>{let d=l;e[s][d.iconSlug]=d}))}),e}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=b({token:o,factory:o.\u0275fac,providedIn:"root"});let u=o;return u})();export{I as a,te as b};
